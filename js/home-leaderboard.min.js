const REPO_OWNER="sayeeg-11";const REPO_NAME="Pixel_Phantoms";const API_BASE=`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}`;const XP_MULTIPLIER=100;const POINTS={L3:11,L2:5,L1:2,DEFAULT:1};const LEAGUES={GOLD:{threshold:15e3,name:"Gold Class",color:"#FFD700"},SILVER:{threshold:7500,name:"Silver Class",color:"#C0C0C0"},BRONZE:{threshold:3e3,name:"Bronze Class",color:"#CD7F32"},ROOKIE:{threshold:0,name:"Rookie Agent",color:"#00aaff"}};document.addEventListener("DOMContentLoaded",()=>{initLeaderboard()});async function initLeaderboard(){const container=document.getElementById("lb-rows");try{const pulls=await fetchAllPulls();const scores=calculateScores(pulls);const topContributors=getTopContributors(scores);renderLeaderboard(topContributors)}catch(error){console.error("Leaderboard Sync Failed:",error);if(container)container.innerHTML=`<div style="padding:20px; text-align:center; color:#ff5f56;">Connection Lost. Retrying uplink...</div>`}}async function fetchAllPulls(){let pulls=[];let page=1;while(page<=3){try{const res=await fetch(`${API_BASE}/pulls?state=all&per_page=100&page=${page}`);if(!res.ok)break;const data=await res.json();if(!data.length)break;pulls=pulls.concat(data);page++}catch(e){break}}return pulls}function calculateScores(pulls){const statsMap={};pulls.forEach(pr=>{if(!pr.merged_at)return;const user=pr.user.login;if(user.toLowerCase()===REPO_OWNER.toLowerCase())return;if(!statsMap[user])statsMap[user]=0;let prPoints=0;let hasLevel=false;pr.labels.forEach(label=>{const name=label.name.toLowerCase();if(name.includes("level 3")||name.includes("level-3")){prPoints+=POINTS.L3;hasLevel=true}else if(name.includes("level 2")||name.includes("level-2")){prPoints+=POINTS.L2;hasLevel=true}else if(name.includes("level 1")){prPoints+=POINTS.L1;hasLevel=true}});if(!hasLevel)prPoints+=POINTS.DEFAULT;statsMap[user]+=prPoints});return statsMap}function getTopContributors(statsMap){return Object.entries(statsMap).map(([login,points])=>({login:login,xp:points*XP_MULTIPLIER})).sort((a,b)=>b.xp-a.xp).slice(0,5)}function getLeagueInfo(xp){if(xp>=LEAGUES.GOLD.threshold)return LEAGUES.GOLD;if(xp>=LEAGUES.SILVER.threshold)return LEAGUES.SILVER;if(xp>=LEAGUES.BRONZE.threshold)return LEAGUES.BRONZE;return LEAGUES.ROOKIE}function renderLeaderboard(contributors){const container=document.getElementById("lb-rows");if(!container)return;container.innerHTML="";if(contributors.length===0){container.innerHTML=`<div style="padding:20px; text-align:center;">No active agents found. Be the first!</div>`;return}contributors.forEach((contributor,index)=>{const rank=index+1;const league=getLeagueInfo(contributor.xp);const row=document.createElement("div");row.className=`lb-row rank-${rank}`;row.innerHTML=`
            <div class="lb-rank">
                <div class="lb-rank-badge">${rank}</div>
            </div>
            <div class="lb-user-info">
                <span class="lb-username">@${contributor.login}</span>
                <span class="lb-league-tag" style="color: ${league.color}">${league.name}</span>
            </div>
            <div class="lb-xp-val">
                ${contributor.xp.toLocaleString()} XP
            </div>
        `;container.appendChild(row);row.style.opacity=0;row.style.transform="translateY(10px)";setTimeout(()=>{row.style.transition="all 0.5s ease";row.style.opacity=1;row.style.transform="translateY(0)"},index*100)})}